#!/usr/bin/python

import sys
import socket

# Functions
def check_input():
	check_argv_len()
	ip_address_split = sys.argv[1].split(".")
	try:
		for i in range(len(ip_address_split)):
			check_range(int(ip_address_split[i]))
		check_range(int(sys.argv[2]))
		check_range(int(sys.argv[3]))
	except: # If cannot be type casted to int, then not valid
		help("Error, you passed a non integer")
	check_port_diff()

def check_argv_len():
	if len(sys.argv) != 4:
		help("There are not 3 arguments passed. Exiting...")

def check_range(var, upper_bound=255, lower_bound=0):
	if var > upper_bound:
		help("%s is higher than upper bound of %s. Exiting..." % (var, upper_bound))
	elif var < lower_bound:
		help("%s is lower than lower bound of %s" % (var, lower_bound))

def check_port_diff():
	if int(sys.argv[3]) - int(sys.argv[2]) < 1:
		help("%s is lower than %s" % (sys.argv[3], sys.argv[2]))

def help(message):
	print "This script takes in an IP Address, a begin_port, and a end_port"
	print "Usage: python [filename] [IP Address] [begin_port] [end_port]"
	print "Example: python script.py 192.168.10.20 1 65535"
	print message
	sys.exit()

# Check input
check_input()

# Assign variables
ip_address = sys.argv[1]
begin_port = int(sys.argv[2])
end_port = int(sys.argv[3])

# Loop through ports
for i in range((end_port - begin_port) + 1):
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	if s.connect_ex((ip_address, begin_port + i)):
		print "Port %s is closed" % (begin_port + i)
	else:
		print "Port %s is open" % (begin_port + i)
	s.close()